# ğŸ¯ e-GP Document Helper - Complete OCR Flow

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  popup.html                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  [ ğŸ“‹ Scan Tender IDs ]  Button             â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”‚ (click)                                              â”‚
â”‚         â–¼                                                       â”‚
â”‚  popup.js â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                                                â”‚                 â”‚
                                                â”‚ startUnifiedScanâ”‚
                                                â–¼                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SERVICE WORKER                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  background.js (v2.0.1)                                        â”‚
â”‚                                                                 â”‚
â”‚  âœ“ Manages offscreen document                                  â”‚
â”‚  âœ“ Captures screenshots                                        â”‚
â”‚  âœ“ Routes messages                                             â”‚
â”‚  âŒ NO DOM APIs (no Image, no Canvas)                          â”‚
â”‚                                                                 â”‚
â”‚  handleStartUnifiedScan()                                      â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”‚ activateUnifiedSelection                             â”‚
â”‚         â–¼                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                   
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CONTENT SCRIPT                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  content.js (v2.0.1)                                           â”‚
â”‚                                                                 â”‚
â”‚  âœ“ Has DOM access                                              â”‚
â”‚  âœ“ Selection overlay                                           â”‚
â”‚  âœ“ Image cropping (Canvas)                                     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ 1. Show selection overlay            â”‚                     â”‚
â”‚  â”‚ 2. User draws rectangle              â”‚                     â”‚
â”‚  â”‚ 3. Extract DOM text first            â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                 â”‚                                               â”‚
â”‚                 â”‚ Found IDs?                                    â”‚
â”‚            â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                                         â”‚
â”‚            â”‚         â”‚                                          â”‚
â”‚          YES        NO                                          â”‚
â”‚            â”‚         â”‚                                          â”‚
â”‚            â”‚         â”‚ (Fallback to OCR)                       â”‚
â”‚            â”‚         â”‚                                          â”‚
â”‚            â”‚         â”‚ captureScreenshot                       â”‚
â”‚            â”‚         â–¼                                          â”‚
â”‚            â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚            â”‚   â”‚  background.js   â”‚                           â”‚
â”‚            â”‚   â”‚  Captures screen â”‚                           â”‚
â”‚            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚            â”‚            â”‚                                       â”‚
â”‚            â”‚            â”‚ returns imageDataUrl                 â”‚
â”‚            â”‚            â–¼                                       â”‚
â”‚            â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚            â”‚   â”‚ cropAndRunOCR()      â”‚                       â”‚
â”‚            â”‚   â”‚ - Load Image         â”‚                       â”‚
â”‚            â”‚   â”‚ - Create Canvas      â”‚                       â”‚
â”‚            â”‚   â”‚ - Crop to selection  â”‚                       â”‚
â”‚            â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚            â”‚            â”‚                                       â”‚
â”‚            â”‚            â”‚ processOCR (cropped image)           â”‚
â”‚            â”‚            â–¼                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                                     
             â”‚                                                     
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            â”‚         OFFSCREEN DOCUMENT                         â”‚
â”‚            â”‚                                                     â”‚
â”‚            â–¼                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  offscreen.html                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ <script src="tesseract/tesseract.min.js">â”‚                 â”‚
â”‚  â”‚ <script src="offscreen.js"></script>      â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”‚ Exposes: window.Tesseract                            â”‚
â”‚         â–¼                                                       â”‚
â”‚  offscreen.js                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ âœ“ Tesseract.createWorker() available     â”‚                 â”‚
â”‚  â”‚                                           â”‚                 â”‚
â”‚  â”‚ runOCR(imageDataUrl)                     â”‚                 â”‚
â”‚  â”‚   â”œâ”€ Create worker                       â”‚                 â”‚
â”‚  â”‚   â”œâ”€ Load language ('eng')               â”‚                 â”‚
â”‚  â”‚   â”œâ”€ Initialize                          â”‚                 â”‚
â”‚  â”‚   â”œâ”€ Recognize text                      â”‚                 â”‚
â”‚  â”‚   â”œâ”€ Extract IDs (/\b\d{6,8}\b/g)       â”‚                 â”‚
â”‚  â”‚   â””â”€ Terminate worker                    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â”‚                                                       â”‚
â”‚         â”‚ returns { success, tenderIds, idsString }            â”‚
â”‚         â–¼                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                                     
             â”‚ tenderIdsExtracted                                 
             â–¼                                                     
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  background.js                                                  â”‚
â”‚    â”‚                                                            â”‚
â”‚    â”‚ fillTenderIds                                             â”‚
â”‚    â–¼                                                            â”‚
â”‚  popup.js                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ Display results:                          â”‚                 â”‚
â”‚  â”‚ "âœ… Found 5 Tender ID(s)"                â”‚                 â”‚
â”‚  â”‚ 12345678, 23456789, 34567890...          â”‚                 â”‚
â”‚  â”‚                                           â”‚                 â”‚
â”‚  â”‚ âœ“ Copied to clipboard                    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Components

### 1. popup.html/js
- User interface
- Single "Scan Tender IDs" button
- Displays results

### 2. background.js (Service Worker)
- âŒ Cannot use: `Image()`, `Canvas`, `document`
- âœ“ Can use: `chrome.tabs.captureVisibleTab()`
- Manages offscreen document lifecycle
- Routes messages between components

### 3. content.js
- âœ“ Has full DOM access
- Handles selection overlay
- Extracts DOM text (priority 1)
- Crops images using Canvas (priority 2)
- Sends to offscreen for OCR

### 4. offscreen.html/js
- âœ“ Loads Tesseract via `<script>` tag
- âœ“ Has DOM access
- Runs OCR processing
- Returns extracted IDs

## Message Flow

```
popup â†’ background: "startUnifiedScan"
background â†’ content: "activateUnifiedSelection"
[User draws rectangle]
content â†’ content: extractDOMText()
  â”œâ”€ Success â†’ Done
  â””â”€ Failure:
      content â†’ background: "captureScreenshot"
      background â†’ content: { imageDataUrl }
      content â†’ content: cropImage() [Canvas]
      content â†’ background: "processOCR" { croppedImage }
      background â†’ offscreen: "runOCR" { image }
      offscreen â†’ offscreen: Tesseract.createWorker()
      offscreen â†’ background: { tenderIds }
      background â†’ content: { tenderIds }
      content â†’ background: "tenderIdsExtracted"
      background â†’ popup: "fillTenderIds"
```

## Technology Stack

- **Chrome Extension**: Manifest V3
- **OCR Engine**: Tesseract.js v5.1.1
- **Language**: English (eng.traineddata.gz)
- **Pattern**: `/\b\d{6,8}\b/g` (6-8 digit numbers)

## File Sizes

```
tesseract.min.js:           66 KB
worker.min.js:             123 KB
tesseract-core.wasm.js:  4.7 MB
eng.traineddata.gz:      ~4.8 MB (loaded on demand)
```

## Performance

- **Initial Load**: 2-3 seconds (loads WASM + language data)
- **DOM Extraction**: <100ms (instant)
- **OCR Processing**: 1-2 seconds per selection
- **Total Flow**: 2-5 seconds from click to results
